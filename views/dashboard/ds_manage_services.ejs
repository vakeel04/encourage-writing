<%- include("partials/aside") %>

<main class="flex-1 p-6 overflow-auto">
  <!-- Header -->
  <div class="flex justify-between items-end">
    <div>
      <h1 class="text-3xl font-bold text-[#000]">Manage Services</h1>
      <p class="mt-2 text-gray-700">Create, edit, or delete your services below.</p>
    </div>

    <!-- Add Button -->
    <div>
      <button
        id="openAddModalBtn"
        class="font-medium text-[#000] border border-[#000] px-6 py-2 text-[14px] cursor-pointer rounded hover:bg-[#000] hover:text-white transition"
      >
        + Add Service
      </button>
    </div>
  </div>

<!-- Service Table -->
<div class="bg-white p-6 rounded shadow mt-6 overflow-x-auto">
  <h2 class="text-[#000] font-semibold text-xl mb-4">Services List</h2>
  <table class="min-w-full table-auto border-collapse">
    <thead>
      <tr class="bg-gray-100 text-left">
        <th class="px-4 py-2 border">Name</th>
        <th class="px-4 py-2 border">Title</th>
        <th class="px-4 py-2 border">Description</th>
        <th class="px-4 py-2 border">Image</th>
        <th class="px-4 py-2 border">Actions</th>
      </tr>
    </thead>
    <tbody id="serviceTableBody">
      <% data?.service?.forEach((service) => { %>
        <tr>
          <td class="px-4 py-2 border"><%= service.name %></td>
          <td class="px-4 py-2 border"><%= service.title %></td>
          <td class="px-4 py-2 border"><%= service.description %></td>
          <td class="px-4 py-2 border">
            <% if(service.image){ %>
              <img src="/<%= service.image %>" class="h-16 w-16 object-cover rounded" alt="<%= service.title %>" />
            <% } else { %>
              N/A
            <% } %>
          </td>
 
          <td class="px-4 py-2 border space-x-2">
            <button
            class="bg-[#000] text-white px-2 py-1 rounded cursor-pointer openEditModalBtn"
            data-id="<%= service._id %>"
            data-name="<%= service.name %>"
            data-title="<%= service.title %>"
            data-description="<%= service.description %>"
            data-fastdelivery="<%= service.fastDelivery %>"
            data-qualityassured="<%= service.qualityAssured %>"
            data-expertwriters="<%= service.expertWriters %>"
            data-meta_title="<%= service.meta_title %>"
            data-meta_description="<%= service.meta_description %>"
            data-keywords="<%= service.keywords %>"
            data-og_title="<%= service.og_title %>"
            data-og_description="<%= service.og_description %>"
            data-og_url="<%= service.og_url %>"
            data-og_type="<%= service.og_type %>"
            data-status="<%= service.status %>"
          >
            Edit
          </button>
          
            <button
              class="border cursor-pointer px-2 py-1 rounded deleteBtn"
              data-id="<%= service._id %>"
            >
              Delete
            </button>
          </td>
        </tr>
      <% }); %>
    </tbody>
    
  </table>
</div>

</main>

<!-- Add Service Modal -->
<div
  id="addServiceModal"
  class="hidden fixed inset-0 bg-black/40 flex items-center justify-center z-50"
>
  <div class="bg-white w-[90%] max-w-lg rounded-lg shadow-lg p-6 relative max-h-[90vh] overflow-y-auto">
    <button
      id="closeAddServiceModalBtn"
      class="absolute top-3 right-3 text-gray-500 hover:text-black text-xl"
    >
      &times;
    </button>
    <h2 class="text-[#000] font-semibold text-xl mb-4">Add New Service</h2>
    <form id="addServiceForm" class="space-y-4">
      <!-- Name -->
      <div>
        <label class="block text-gray-700 font-medium mb-1" for="name">Name</label>
        <input type="text" id="name" class="w-full border border-gray-300 rounded p-2" required />
      </div>

      <!-- Title -->
      <div>
        <label class="block text-gray-700 font-medium mb-1" for="title">Title</label>
        <input type="text" id="title" class="w-full border border-gray-300 rounded p-2" required />
      </div>

      <!-- Description -->
      <div>
        <label class="block text-gray-700 font-medium mb-1" for="description">Description</label>
        <textarea id="description" class="w-full border border-gray-300 rounded p-2" rows="3" required></textarea>
      </div>

      <!-- Features -->
      <div>
        <label class="block text-gray-700 font-medium mb-1">Features</label>
        <input type="text" id="fastDelivery" placeholder="Fast Delivery info" class="w-full border border-gray-300 rounded p-2 mb-2" />
        <input type="text" id="QualityAssured" placeholder="Quality Assured info" class="w-full border border-gray-300 rounded p-2 mb-2" />
        <input type="text" id="expertWriters" placeholder="Expert Writers info" class="w-full border border-gray-300 rounded p-2" />
      </div>

      <!-- Image -->
      <div>
        <label class="block text-gray-700 font-medium mb-1" for="image">Image</label>
        <input type="file" id="image" class="w-full border border-gray-300 rounded p-2 cursor-pointer" required />
      </div>

      <!-- Meta Info -->
      <div class="border-t pt-4 mt-4">
        <h3 class="text-lg font-semibold text-[#000] mb-2">SEO Meta Info</h3>
        <input type="text" id="meta_title" placeholder="Meta Title" class="w-full border border-gray-300 rounded p-2 mb-2" />
        <textarea id="meta_description" placeholder="Meta Description" rows="2" class="w-full border border-gray-300 rounded p-2 mb-2"></textarea>
        <input type="text" id="keywords" placeholder="Keywords" class="w-full border border-gray-300 rounded p-2" />
      </div>

      <!-- OG Info -->
      <div class="border-t pt-4 mt-4">
        <h3 class="text-lg font-semibold text-[#000] mb-2">Open Graph (OG) Info</h3>
        <input type="text" id="og_title" placeholder="OG Title" class="w-full border border-gray-300 rounded p-2 mb-2" />
        <textarea id="og_description" placeholder="OG Description" rows="2" class="w-full border border-gray-300 rounded p-2 mb-2"></textarea>
        <input type="file" id="og_image" class="w-full border border-gray-300 rounded p-2 cursor-pointer mb-2" />
        <input type="text" id="og_url" placeholder="OG URL" class="w-full border border-gray-300 rounded p-2 mb-2" />
        <input type="text" id="og_type" placeholder="OG Type" class="w-full border border-gray-300 rounded p-2" />
      </div>

      <button
        type="submit"
        class="bg-[#000] text-white px-4 py-2 rounded hover:bg-gray-800 transition mt-4"
      >
        Add Service
      </button>
    </form>
  </div>
</div>


<!-- Edit Service Modal -->
<div
  id="editServiceModal"
  class="hidden fixed inset-0 bg-black/40 flex items-center justify-center z-50"
>
  <div class="bg-white w-[90%] max-w-lg rounded-lg shadow-lg p-6 relative max-h-[90vh] overflow-y-auto">
    <button
      id="closeEditServiceModalBtn"
      class="absolute top-3 right-3 text-gray-500 hover:text-black text-xl"
    >
      &times;
    </button>
    <h2 class="text-[#000] font-semibold text-xl mb-4">Edit Service</h2>
    <form id="editServiceForm" class="space-y-4">
      
      <!-- Name -->
      <div>
        <label class="block text-gray-700 font-medium mb-1" for="editName">Name</label>
        <input type="text" id="editName" class="w-full border border-gray-300 rounded p-2" required />
      </div>

      <!-- Title -->
      <div>
        <label class="block text-gray-700 font-medium mb-1" for="editTitle">Title</label>
        <input type="text" id="editTitle" class="w-full border border-gray-300 rounded p-2" required />
      </div>

      <!-- Description -->
      <div>
        <label class="block text-gray-700 font-medium mb-1" for="editDescription">Description</label>
        <textarea id="editDescription" class="w-full border border-gray-300 rounded p-2" rows="3" required></textarea>
      </div>

      <!-- Features -->
      <div>
        <label class="block text-gray-700 font-medium mb-1">Features</label>
        <input type="text" id="editFastDelivery" placeholder="Fast Delivery info" class="w-full border border-gray-300 rounded p-2 mb-2" />
        <input type="text" id="editQualityAssured" placeholder="Quality Assured info" class="w-full border border-gray-300 rounded p-2 mb-2" />
        <input type="text" id="editExpertWriters" placeholder="Expert Writers info" class="w-full border border-gray-300 rounded p-2" />
      </div>

      <!-- Image -->
      <div>
        <label class="block text-gray-700 font-medium mb-1" for="editImage">Image</label>
        <input type="file" id="editImage" class="w-full border border-gray-300 rounded p-2 cursor-pointer" />
      </div>

      <!-- SEO Meta Info -->
      <div class="border-t pt-4 mt-4">
        <h3 class="text-lg font-semibold text-[#000] mb-2">SEO Meta Info</h3>
        <input type="text" id="editMetaTitle" placeholder="Meta Title" class="w-full border border-gray-300 rounded p-2 mb-2" />
        <textarea id="editMetaDescription" placeholder="Meta Description" rows="2" class="w-full border border-gray-300 rounded p-2 mb-2"></textarea>
        <input type="text" id="editKeywords" placeholder="Keywords" class="w-full border border-gray-300 rounded p-2" />
      </div>

      <!-- OG Info -->
      <div class="border-t pt-4 mt-4">
        <h3 class="text-lg font-semibold text-[#000] mb-2">Open Graph (OG) Info</h3>
        <input type="text" id="editOgTitle" placeholder="OG Title" class="w-full border border-gray-300 rounded p-2 mb-2" />
        <textarea id="editOgDescription" placeholder="OG Description" rows="2" class="w-full border border-gray-300 rounded p-2 mb-2"></textarea>
        <input type="file" id="editOgImage" class="w-full border border-gray-300 rounded p-2 cursor-pointer mb-2" />
        <input type="text" id="editOgUrl" placeholder="OG URL" class="w-full border border-gray-300 rounded p-2 mb-2" />
        <input type="text" id="editOgType" placeholder="OG Type" class="w-full border border-gray-300 rounded p-2" />
      </div>

 

      <button
        type="submit"
        class="bg-[#000] text-white px-4 py-2 rounded hover:bg-gray-800 transition mt-4"
      >
        Save Changes
      </button>
    </form>
  </div>
</div>


 

<!-- add ki api  -->
<script>
  // Modal Elements
  const addServiceModal = document.getElementById("addServiceModal");
  const openAddModalBtn = document.getElementById("openAddModalBtn");
  const closeAddServiceBtn = document.getElementById("closeAddServiceModalBtn");
  const addServiceForm = document.getElementById("addServiceForm");

  // Open Modal
  openAddModalBtn.addEventListener("click", () => {
    addServiceModal.classList.remove("hidden");
  });

  // Close Modal
  closeAddServiceBtn.addEventListener("click", () => {
    addServiceModal.classList.add("hidden");
  });

  // Handle Form Submission
  addServiceForm.addEventListener("submit", async (e) => {
    e.preventDefault();

    const formData = new FormData();
    formData.append("name", document.getElementById("name").value);
    formData.append("title", document.getElementById("title").value);
    formData.append("description", document.getElementById("description").value);

    // Features
    formData.append("fastDelivery", document.getElementById("fastDelivery").value);
    formData.append("QualityAssured", document.getElementById("QualityAssured").value);
    formData.append("expertWriters", document.getElementById("expertWriters").value);

    // Image
    const imageFile = document.getElementById("image").files[0];
    if(imageFile) formData.append("image", imageFile);

    // Meta Info
    formData.append("meta_title", document.getElementById("meta_title").value);
    formData.append("meta_description", document.getElementById("meta_description").value);
    formData.append("keywords", document.getElementById("keywords").value);

    // OG Info
    formData.append("og_title", document.getElementById("og_title").value);
    formData.append("og_description", document.getElementById("og_description").value);
    const ogImageFile = document.getElementById("og_image").files[0];
    if(ogImageFile) formData.append("og_image", ogImageFile);
    formData.append("og_url", document.getElementById("og_url").value);
    formData.append("og_type", document.getElementById("og_type").value);

    try {
      const response = await fetch("/api/service", {  // Replace with your API endpoint
        method: "POST",
        body: formData
      });

      const result = await response.json();

      if(result.status) {
        alert("Service added successfully!");
        addServiceForm.reset();
        addServiceModal.classList.add("hidden");
        // Optionally, refresh the table or append the new service dynamically
        location.reload()
      } else {
        alert("Failed to add service: " + result.message);
      }
    } catch (error) {
      console.error(error);
      alert("An error occurred while adding service.");
    }
  });
</script>

<!-- Delete Service -->
<script>
  document.querySelectorAll(".deleteBtn").forEach((btn) => {
    btn.addEventListener("click", async () => {
      const serviceId = btn.getAttribute("data-id");
      if (!confirm("Are you sure you want to delete this service?")) return;

      try {
        const response = await fetch(`/api/service/${serviceId}`, {  
          method: "DELETE",
        });

        const result = await response.json();

        if (result.status) {
          alert("Service deleted successfully!");
          // Remove row from table
          btn.closest("tr").remove();
        } else {
          alert("Failed to delete service: " + result.message);
        }
      } catch (error) {
        console.error(error);
        alert("An error occurred while deleting service.");
      }
    });
  });
</script>

<!-- update ki api  -->
<script>
  // Open Edit Modal & Populate Fields
  const editServiceModal = document.getElementById("editServiceModal");
  const closeEditServiceModalBtn = document.getElementById("closeEditServiceModalBtn");
  const editButtons = document.querySelectorAll(".openEditModalBtn");

  editButtons.forEach((btn) => {
    btn.addEventListener("click", () => {
      const serviceId = btn.getAttribute("data-id");
      // Populate fields using data-* attributes
      document.getElementById("editName").value = btn.getAttribute("data-name");
      document.getElementById("editTitle").value = btn.getAttribute("data-title");
      document.getElementById("editDescription").value = btn.getAttribute("data-description");
      document.getElementById("editFastDelivery").value = btn.getAttribute("data-fastdelivery");
      document.getElementById("editQualityAssured").value = btn.getAttribute("data-qualityassured");
      document.getElementById("editExpertWriters").value = btn.getAttribute("data-expertwriters");
      document.getElementById("editMetaTitle").value = btn.getAttribute("data-meta_title");
      document.getElementById("editMetaDescription").value = btn.getAttribute("data-meta_description");
      document.getElementById("editKeywords").value = btn.getAttribute("data-keywords");
      document.getElementById("editOgTitle").value = btn.getAttribute("data-og_title");
      document.getElementById("editOgDescription").value = btn.getAttribute("data-og_description");
      document.getElementById("editOgUrl").value = btn.getAttribute("data-og_url");
      document.getElementById("editOgType").value = btn.getAttribute("data-og_type");
      document.getElementById("editServiceForm").setAttribute("data-id", serviceId);

      editServiceModal.classList.remove("hidden");
    });
  });

  closeEditServiceModalBtn.addEventListener("click", () => {
    editServiceModal.classList.add("hidden");
  });

  // Handle Update Form Submit
  document.getElementById("editServiceForm").addEventListener("submit", async (e) => {
    e.preventDefault();
    const serviceId = e.target.getAttribute("data-id");

    const formData = new FormData();
    formData.append("name", document.getElementById("editName").value);
    formData.append("title", document.getElementById("editTitle").value);
    formData.append("description", document.getElementById("editDescription").value);
    formData.append("fastDelivery", document.getElementById("editFastDelivery").value);
    formData.append("qualityAssured", document.getElementById("editQualityAssured").value);
    formData.append("expertWriters", document.getElementById("editExpertWriters").value);
    formData.append("meta_title", document.getElementById("editMetaTitle").value);
    formData.append("meta_description", document.getElementById("editMetaDescription").value);
    formData.append("keywords", document.getElementById("editKeywords").value);
    formData.append("og_title", document.getElementById("editOgTitle").value);
    formData.append("og_description", document.getElementById("editOgDescription").value);
    formData.append("og_url", document.getElementById("editOgUrl").value);
    formData.append("og_type", document.getElementById("editOgType").value);

    const imageFile = document.getElementById("editImage").files[0];
    if (imageFile) formData.append("image", imageFile);

    const ogImageFile = document.getElementById("editOgImage").files[0];
    if (ogImageFile) formData.append("og_image", ogImageFile);

    try {
      const response = await fetch(`/api/service/${serviceId}`, {
        method: "PUT",
        body: formData
      });
      const result = await response.json();

      if (result.status) {
        alert("Service updated successfully!");
        // Optionally: update the table row dynamically here
        editServiceModal.classList.add("hidden");
        location.reload(); // simple way to refresh table, or update DOM manually
      } else {
        alert("Failed to update service: " + result.message);
      }
    } catch (error) {
      console.error(error);
      alert("An error occurred while updating service.");
    }
  });
</script>
